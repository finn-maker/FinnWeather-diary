# ğŸ”’ Firebaseå®‰å…¨è§„åˆ™é…ç½®æŒ‡å—

## ğŸš¨ å½“å‰é—®é¢˜
ä½ çš„åº”ç”¨æ˜¾ç¤º **"Missing or insufficient permissions"** é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºFirestoreå®‰å…¨è§„åˆ™é˜»æ­¢äº†æ•°æ®è®¿é—®ã€‚

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### ç¬¬1æ­¥ï¼šç™»å½•Firebaseæ§åˆ¶å°
1. è®¿é—®ï¼šhttps://console.firebase.google.com/
2. é€‰æ‹©ä½ çš„é¡¹ç›®ï¼š`weather-diary-app-69053`
3. åœ¨å·¦ä¾§èœå•ç‚¹å‡» **"Firestore Database"**

### ç¬¬2æ­¥ï¼šä¿®æ”¹å®‰å…¨è§„åˆ™
1. åœ¨Firestore Databaseé¡µé¢ï¼Œç‚¹å‡» **"è§„åˆ™"** æ ‡ç­¾
2. å°†ç°æœ‰è§„åˆ™æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹ï¼š

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // å…è®¸åŒ¿åç”¨æˆ·è®¿é—®diariesé›†åˆ
    match /diaries/{document} {
      // å…è®¸è¯»å–ï¼šç”¨æˆ·å·²è®¤è¯
      allow read: if request.auth != null;
      
      // å…è®¸åˆ›å»ºï¼šç”¨æˆ·å·²è®¤è¯ä¸”userIdåŒ¹é…
      allow create: if request.auth != null 
        && request.auth.uid == resource.data.userId;
      
      // å…è®¸æ›´æ–°ï¼šç”¨æˆ·å·²è®¤è¯ä¸”userIdåŒ¹é…
      allow update: if request.auth != null 
        && request.auth.uid == resource.data.userId;
      
      // å…è®¸åˆ é™¤ï¼šç”¨æˆ·å·²è®¤è¯ä¸”userIdåŒ¹é…
      allow delete: if request.auth != null 
        && request.auth.uid == resource.data.userId;
    }
    
    // å…è®¸åŒ¿åç”¨æˆ·è®¿é—®ç”¨æˆ·é…ç½®
    match /users/{userId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == userId;
    }
  }
}
```

### ç¬¬3æ­¥ï¼šå‘å¸ƒè§„åˆ™
1. ç‚¹å‡» **"å‘å¸ƒ"** æŒ‰é’®
2. ç­‰å¾…è§„åˆ™ç”Ÿæ•ˆï¼ˆé€šå¸¸å‡ ç§’é’Ÿï¼‰

## ğŸ§ª æµ‹è¯•é…ç½®

### æ–¹æ³•1ï¼šä½¿ç”¨Firebaseæ§åˆ¶å°æµ‹è¯•
1. åœ¨Firestore Databaseé¡µé¢ç‚¹å‡» **"å¼€å§‹é›†åˆ"**
2. é›†åˆIDè¾“å…¥ï¼š`diaries`
3. æ–‡æ¡£IDï¼šè‡ªåŠ¨ç”Ÿæˆ
4. æ·»åŠ å­—æ®µï¼š
   - `userId`: `test-user`
   - `title`: `æµ‹è¯•æ—¥è®°`
   - `content`: `è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ—¥è®°`
   - `timestamp`: `1705741800000`
5. ç‚¹å‡» **"ä¿å­˜"**

### æ–¹æ³•2ï¼šé‡å¯åº”ç”¨æµ‹è¯•
1. åœæ­¢å¼€å‘æœåŠ¡å™¨ï¼š`Ctrl+C`
2. é‡æ–°å¯åŠ¨ï¼š`npm start`
3. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
4. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦è¿˜æœ‰æƒé™é”™è¯¯

## ğŸ” è§„åˆ™è¯´æ˜

### åŒ¿åè®¤è¯è§„åˆ™
```javascript
allow read: if request.auth != null;
```
- åªå…è®¸å·²è®¤è¯çš„ç”¨æˆ·è¯»å–æ•°æ®
- æ”¯æŒåŒ¿åç™»å½•

### ç”¨æˆ·æ•°æ®éš”ç¦»
```javascript
allow create: if request.auth != null 
  && request.auth.uid == resource.data.userId;
```
- ç”¨æˆ·åªèƒ½åˆ›å»ºå±äºè‡ªå·±çš„æ—¥è®°
- é˜²æ­¢æ•°æ®æ³„éœ²

### æ•°æ®å®‰å…¨
```javascript
allow update, delete: if request.auth != null 
  && request.auth.uid == resource.data.userId;
```
- ç”¨æˆ·åªèƒ½ä¿®æ”¹/åˆ é™¤è‡ªå·±çš„æ—¥è®°
- ç¡®ä¿æ•°æ®å®‰å…¨

## â— å¸¸è§é—®é¢˜

### Q: è§„åˆ™å‘å¸ƒåè¿˜æ˜¯æŠ¥é”™ï¼Ÿ
A: ç­‰å¾…1-2åˆ†é’Ÿè®©è§„åˆ™ç”Ÿæ•ˆï¼Œç„¶ååˆ·æ–°é¡µé¢é‡è¯•ã€‚

### Q: æµ‹è¯•æ¨¡å¼å¯ä»¥ç»§ç»­ä½¿ç”¨å—ï¼Ÿ
A: æµ‹è¯•æ¨¡å¼30å¤©åè¿‡æœŸï¼Œå»ºè®®é…ç½®æ­£å¼è§„åˆ™ã€‚

### Q: è§„åˆ™å¤ªå¤æ‚äº†ï¼Ÿ
A: å¯ä»¥ä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰ï¼š

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
```

âš ï¸ **æ³¨æ„ï¼šç®€åŒ–è§„åˆ™å…è®¸ä»»ä½•äººè¯»å†™æ•°æ®ï¼Œä»…ç”¨äºæµ‹è¯•ï¼**

## ğŸ¯ æœ€ä½³å®è·µ

1. **å¼€å‘é˜¶æ®µ**ï¼šä½¿ç”¨æµ‹è¯•æ¨¡å¼æˆ–ç®€åŒ–è§„åˆ™
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨å®Œæ•´çš„ç”¨æˆ·éš”ç¦»è§„åˆ™
3. **å®šæœŸæ£€æŸ¥**ï¼šç›‘æ§Firebaseæ§åˆ¶å°çš„è®¿é—®æ—¥å¿—
4. **å¤‡ä»½è§„åˆ™**ï¼šä¿å­˜è§„åˆ™é…ç½®åˆ°æœ¬åœ°æ–‡ä»¶

## ğŸ“Š è§„åˆ™éªŒè¯

é…ç½®å®Œæˆåï¼Œä½ çš„åº”ç”¨åº”è¯¥æ˜¾ç¤ºï¼š
```
â˜ï¸ äº‘ç«¯å­˜å‚¨å·²å¯ç”¨ï¼Œä½¿ç”¨æ··åˆæ¨¡å¼
âœ… åŒæ­¥å®Œæˆ: æˆåŠŸ 0 æ¡, å¤±è´¥ 0 æ¡
```

è€Œä¸æ˜¯ï¼š
```
âŒ äº‘ç«¯è¿æ¥æ£€æŸ¥å¤±è´¥: FirebaseError: Missing or insufficient permissions
```

---

ğŸ’¡ **é…ç½®å®Œæˆåï¼Œä½ çš„å¤©æ°”æ—¥è®°å°†æ”¯æŒå®‰å…¨çš„äº‘ç«¯å­˜å‚¨å’Œå¤šè®¾å¤‡åŒæ­¥ï¼** 